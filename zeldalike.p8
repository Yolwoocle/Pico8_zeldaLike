pico-8 cartridge // http://www.pico-8.com
version 33
__lua__
--game name goes here
--by gouspourd,yolwoocle,notgoyome

function _init()
	init_player()
	init_bullet()
end

function _update60()
 mouse_x_y()
	update_bullet()
	player_update()	
	for i in all(player) do
	 if (stat(34) & 1==1) spawn_bullet(i.x,i.y,1,2)
	end
end

function _draw()
 cls()
 map()
	draw_bullet()
	draw_mouse()
	draw_player()
	check_flag(1,mouse_x,mouse_y)
end
-->8
--player
function init_player()
	player={}
	add(player,{nb_player=1,x=64,y=64})
end

function player_update()
local xnext = 0
local ynext = 0
	 for i in all(player) do
	  if (btn(⬅️)) xnext-=1
	  if (btn(➡️)) xnext+=1
	  if (btn(⬆️)) ynext-=1
	  if (btn(⬇️)) ynext+=1
	  if not collision(i.x+xnext,i.y+ynext,1) then
	   i.x+=xnext
	   i.y+=ynext
	  end
	 end
end

function draw_player()
	for i in all(player) do
		spr(3,i.x,i.y)
	end
end

-->8
--bullet
function init_bullet()
	bullet = {}
end

function spawn_bullet(x,y,type_bullet,speed)
 xy = get_traj(x,y,mouse_x,mouse_y)
 traj_x = xy.x*speed
 traj_y = xy.y*speed
	add(bullet,{x=x,y=y,type_bullet=type_bullet,speed=speed,traj_x=traj_x,traj_y=traj_y})
	
end

function update_bullet()
	for i in all(bullet) do
		if check_flag(1,i.x+(i.traj_x*1.5)+4,i.y+4+(i.traj_y*1.5)) then
		 del(bullet,i)
	 end
		i.x += i.traj_x
		i.y += i.traj_y
	end
end

function draw_bullet()
	for i in all(bullet) do
		spr(i.type_bullet,i.x,i.y)
	end
end

-->8
--mouse
function mouse_x_y()
	poke(0x5f2d, 1)
	mouse_x=stat(32)
	mouse_y=stat(33)
end

function get_traj(x_satr,y_start,x_end,y_end)
	angle=atan2(x_end-x_satr-4, y_end-y_start-4)
	return {x = cos(angle),y = sin(angle)}
end

function draw_mouse()
	spr(2,mouse_x,mouse_y)
end

function check_flag(flag,x,y)
	return fget(mget((x\8),(y\8)),flag)
end

-->8
--collision
function collision(x,y,flag)
	if not check_flag(flag,x,y) and
	not check_flag(flag,x+7,y+7) and
	not check_flag(flag,x+7,y) and
	not check_flag(flag,x,y+7) then
	 return false
	else return true				
	 end
end
__gfx__
000000000000000077700000cc0000cc806600685500005500000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000071100000c000000c065006555000000500000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000990007000000000000000050000550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000009aa9001000000000000000000660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000009aa9000000000000000000600655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000990000000000000000000560050060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000c000000c556000655000000500000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000cc0000cc855066585500005500000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
00000000ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000004040404040404000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000004000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000004000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004040000000000000000000004000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000000000000000004000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000000000000000004000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000000000000000404000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000000000004040400000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000004040404000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000004000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000040404040404040404040000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000040404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
